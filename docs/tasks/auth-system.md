# 사용자 인증 시스템 구현

## 개요
색각 이상자를 위한 패션 커뮤니티 'Palette'의 사용자 인증 시스템을 구현합니다.

## 목표
- 안전하고 효율적인 사용자 인증 시스템 구축
- 개인화된 사용자 경험 제공
- 사용자 데이터 보호

## 기능 요구사항

### 1. 회원가입 [구현 중]
- 필수 입력 정보
  - 이메일 (유효성 검사)
  - 비밀번호 (8자 이상, 특수문자 포함)
  - 닉네임 (2-20자)
  - 색각 유형 (정상, 제1색맹, 제2색맹, 제3색맹, 색약)
- 선택 입력 정보
  - 프로필 이미지
  - 자기소개
- 이메일 인증 시스템 [수정 필요]
  - 인증 메일 발송 [완료]
  - 인증 링크 처리 [완료]
  - 인증 상태 관리 [버그: 401 에러 발생 중]
    - 회원가입 후 이메일 인증 페이지 이동은 정상
    - 인증 상태 체크 시 401 에러 발생 문제 해결 필요

### 2. 로그인 [구현 완료]
- 이메일/비밀번호 로그인
- JWT 토큰 기반 인증
- 로그인 상태 유지 옵션
- 토큰 자동 갱신

### 3. 사용자 프로필 [대기 중]
- 프로필 조회
- 프로필 수정
- 비밀번호 변경

### 4. 보안 [구현 완료]
- 비밀번호 암호화 (bcrypt)
- JWT 토큰 관리
- XSS, CSRF 방어

## 기술 스택
- Backend: Express.js, MongoDB
- Frontend: React.js, Material-UI
- 인증: JWT, bcrypt
- 유효성 검사: express-validator, zod

## 구현 단계

### 1단계: 백엔드 구현 [완료]
- [x] 사용자 모델 정의
- [x] 회원가입 API 구현
- [x] 로그인 API 구현
- [x] JWT 미들웨어 구현
- [x] 프로필 API 구현
- [x] 이메일 인증 API 구현

### 2단계: 프론트엔드 구현 [진행 중]
- [x] 회원가입 페이지 구현
- [x] 로그인 페이지 구현
- [x] 이메일 인증 페이지 구현
- [ ] 프로필 페이지 구현
- [x] 인증 상태 관리 구현

### 3단계: 테스트 및 보안 [진행 중]
- [ ] 단위 테스트 작성
- [ ] 통합 테스트 작성
- [x] 보안 취약점 점검
- [x] 에러 처리 보완

## API 엔드포인트

### Auth [구현 완료]
```
POST /api/auth/register - 회원가입
POST /api/auth/login - 로그인
POST /api/auth/logout - 로그아웃
GET /api/auth/me - 현재 사용자 정보
POST /api/auth/verify-email - 이메일 인증
POST /api/auth/resend-verification - 인증 메일 재발송
```

### Profile [진행 중]
```
GET /api/users/:id - 사용자 프로필 조회
PUT /api/users/:id - 프로필 수정
PUT /api/users/:id/password - 비밀번호 변경
```

## 현재 진행 상황

### 해결된 사항
- 회원가입 기본 기능 구현
- 이메일 인증 메일 발송
- 인증 링크 처리
- 로그인 기능
- 기본적인 보안 설정

### 해결 필요 사항
1. 이메일 인증 관련 401 에러
   - 문제: 회원가입 후 인증 상태 체크 시 지속적인 401 에러 발생
   - 원인 분석 중
   - 우선순위: 높음

2. 사용자 프로필 기능
   - 이메일 인증 문제 해결 후 착수 예정

## 다음 단계
1. 이메일 인증 401 에러 해결
2. 인증 상태 관리 로직 개선
3. 사용자 프로필 기능 구현 시작

## 이슈 및 해결 방안
1. 이메일 인증 후 자동 로그인 문제
   - 해결: 인증 완료 후 토큰 관리 로직 개선
2. 토큰 갱신 시 불필요한 API 호출
   - 해결: blockCheckAuthRef를 통한 API 호출 제어
3. 401 에러 처리
   - 해결: 이메일 인증이 필요한 경우 적절한 처리 로직 구현

## 예상 소요 시간
- 백엔드 구현: 2일
- 프론트엔드 구현: 2일
- 테스트 및 보안: 1일
- 총 소요 시간: 5일

## 성공 기준
- 모든 API 엔드포인트가 정상 작동
- 프론트엔드에서 원활한 사용자 경험 제공
- 보안 요구사항 충족
- 테스트 커버리지 80% 이상